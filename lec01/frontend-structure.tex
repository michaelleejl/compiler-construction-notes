\begin{tikzpicture}
\begin{scope}[execute at end node=\strut]
    \node[text width=15mm, align = center] (cstream) at (0, 0) {\scriptsize \sffamily{Characters}};
    
    \node [right = 1 of cstream, rectangle, draw, rounded corners, text width = 20mm, align = center] (lex) {\sffamily{\textbf{Lexer}}};

    \draw[edge, shorten >= 5pt] (cstream) -> (lex);

    
    \node [right = 2 of lex, rectangle, draw, rounded corners, text width = 20mm, align = center] (parse) {\sffamily{\textbf{Parser}}};

    \draw[edge, shorten <= 5pt, shorten >= 5pt] (lex) -> (parse);

    \node[text width=9mm, align = center, fill=white] (tstream) at ($(lex)!0.48!(parse)$) {\scriptsize \sffamily{Tokens}};

    \node[below = 0.2 of tstream, text width=9mm, align = center, fill=white] (lerror) {\scriptsize \textcolor{red}{\sffamily{\textbf{ERROR}}}};

    \draw [red, xshift=4cm, dashed] plot [smooth, tension=1] coordinates { (0.36,0) (0.58,-0.4) (0.38,-0.8) (0.58,-1)};

    \node [right = 2 of parse, rectangle, draw, rounded corners, text width = 20mm, align = center] (tchecker) {\sffamily{\textbf{Type Checker}}};

    \draw[edge, shorten <= 5pt, shorten >= 5pt] (parse) -> (tchecker);

    \draw [red, xshift=4cm, dashed] plot [smooth, tension=1] coordinates { (4.66,0) (4.88,-0.4) (4.68,-0.8) (4.88,-1)};

    \node[text width=5mm, align = center, fill=white] (ast) at ($(parse)!0.48!(tchecker)$) {\scriptsize \sffamily{AST}};

    \node[below = 0.2 of ast, text width=9mm, align = center, fill=white] (perror) {\scriptsize \textcolor{red}{\sffamily{\textbf{ERROR}}}};

    \node[right = 1 of tchecker, text width=21mm, align = center, fill=white] (aast) {\scriptsize \sffamily{Annotated AST}};
    
    \draw[edge, shorten <= 5pt] (tchecker) -> (aast);

    \node[text width=21mm, align = left, fill=white] (terror) at (14.28,-1) {\scriptsize \textcolor{red}{\sffamily{\textbf{ERROR}}}};
    
    \draw [red, xshift=4cm, dashed] plot [smooth, tension=1] coordinates { (8.96,0) (9.18,-0.4) (8.98,-0.8) (9.18,-1)};
    
\end{scope}
\end{tikzpicture}