\begin{tikzpicture}

\node[anchor=north west,minimum height=2.0ex,inner sep=0pt] (code-0) {\scriptsize\texttt{PUSH STACK\_INT 1}};
\node[anchor=north west,minimum height=2.0ex,inner sep=0pt] (code-1) at (code-0.south west) {\scriptsize\texttt{TRY L0 = 7}};
\node[anchor=north west,minimum height=2.0ex,inner sep=0pt] (code-2) at (code-1.south west) {\scriptsize\texttt{PUSH STACK\_INT 2}};
\node[anchor=north west,minimum height=2.0ex,inner sep=0pt] (code-3) at (code-2.south west) {\scriptsize\texttt{PUSH STACK\_INT 3}};
\node[anchor=north west,minimum height=2.0ex,inner sep=0pt] (code-4) at (code-3.south west) {\scriptsize\texttt{OPER ADD}};
\node[anchor=north west,minimum height=2.0ex,inner sep=0pt] (code-5) at (code-4.south west) {\scriptsize\texttt{UNTRY}};
\node[anchor=north west,minimum height=2.0ex,inner sep=0pt] (code-6) at (code-5.south west) {\scriptsize\texttt{GOTO L1 = 10}};
\node[anchor=north west,minimum height=2.0ex,inner sep=0pt] (code-7) at (code-6.south west) {\scriptsize\texttt{LABEL L0}};
\node[anchor=north west,minimum height=2.0ex,inner sep=0pt] (code-8) at (code-7.south west) {\scriptsize\texttt{MK\_CLOSURE(L2 = 13, 0)}};
\node[anchor=north west,minimum height=2.0ex,inner sep=0pt] (code-9) at (code-8.south west) {\scriptsize\texttt{APPLY}};
\node[anchor=north west,minimum height=2.0ex,inner sep=0pt] (code-10)at (code-9.south west)  {\scriptsize\texttt{LABEL L1}};
\node[anchor=north west,minimum height=2.0ex,inner sep=0pt] (code-11) at (code-10.south west) {\scriptsize\texttt{OPER ADD}};
\node[anchor=north west,minimum height=2.0ex,inner sep=0pt] (code-12) at (code-11.south west) {\scriptsize\texttt{HALT}};
\node[anchor=north west,minimum height=2.0ex,inner sep=0pt] (code-13) at (code-12.south west) {\scriptsize\texttt{LABEL L2}};
\node[anchor=north west,minimum height=2.0ex,inner sep=0pt] (code-14) at (code-13.south west) {\scriptsize\texttt{LOOKUP STACK\_LOCATION -2}};
\node[anchor=north west,minimum height=2.0ex,inner sep=0pt] (code-15) at (code-14.south west) {\scriptsize\texttt{PUSH STACK\_INT 10}};
\node[anchor=north west,minimum height=2.0ex,inner sep=0pt] (code-16) at (code-15.south west) {\scriptsize\texttt{OPER ADD}};
\node[anchor=north west,minimum height=2.0ex,inner sep=0pt] (code-17) at (code-16.south west) {\scriptsize\texttt{RETURN}};

\node[anchor=east] (num-0) at (code-0.west) { \color{darkred}\scriptsize 0 };
\node[anchor=east] (num-1) at (code-1.west) { \color{darkred}\scriptsize 1 };
\node[anchor=east] (num-2) at (code-2.west) { \color{darkred}\scriptsize 2 };
\node[anchor=east] (num-3) at (code-3.west) { \color{darkred}\scriptsize 3 };
\node[anchor=east] (num-4) at (code-4.west) { \color{darkred}\scriptsize 4 };
\node[anchor=east] (num-5) at (code-5.west) { \color{darkred}\scriptsize 5 };
\node[anchor=east] (num-6) at (code-6.west) { \color{darkred}\scriptsize 6 };
\node[anchor=east] (num-7) at (code-7.west) { \color{darkred}\scriptsize 7 };
\node[anchor=east] (num-8) at (code-8.west) { \color{darkred}\scriptsize 8 };
\node[anchor=east] (num-9) at (code-9.west) { \color{darkred}\scriptsize 9 };
\node[anchor=east] (num-10) at (code-10.west) { \color{darkred}\scriptsize 10 };
\node[anchor=east] (num-11) at (code-11.west) { \color{darkred}\scriptsize 11 };
\node[anchor=east] (num-12) at (code-12.west) { \color{darkred}\scriptsize 12 };
\node[anchor=east] (num-13) at (code-13.west) { \color{darkred}\scriptsize 13 };
\node[anchor=east] (num-14) at (code-14.west) { \color{darkred}\scriptsize 14 };
\node[anchor=east] (num-15) at (code-15.west) { \color{darkred}\scriptsize 15 };
\node[anchor=east] (num-16) at (code-16.west) { \color{darkred}\scriptsize 16 };
\node[anchor=east] (num-17) at (code-17.west) { \color{darkred}\scriptsize 17 };

\node[anchor=east,circle,draw,minimum width=2ex,fill=darkred!0.5!blue,fill opacity=0.1] (cp) at ($(num-1.west-|num-17.west) + (-3ex,0)$) { };
\draw[->] (cp) -- (num-1);

%% \node<11>[anchor=east,circle,draw,minimum width=2ex,fill=darkred!0.5!blue,fill opacity=0.1] (cp) at ($(num-12.west-|num-17.west) + (-3ex,0)$) { };
%% \draw<11>[->] (cp) -- (num-12);

\node at (cp) { \tiny cp };

\node[anchor=south west,minimum height=0.19\textheight,minimum width=0.23\textwidth] (stack) at ($(code-17.south east) + (0.3\textwidth,0)$) { };

\node[anchor=south west,minimum height=0.19\textheight,minimum width=0.23\textwidth] (heap) at ($(stack.east)  + (0.04\textwidth,0)$) { };

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% HEAP
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% STACK
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{
%% 1: STACK_RA 0
%% 0: STACK_FP 0
  \node[draw=darkest,fill=darkred!0.5!yellow,fill opacity=0.1,rounded corners,minimum width=10ex,minimum height=2.5ex,anchor=south west] (zero) at (stack.south west) { };
  \node[draw=darkest,rounded corners,minimum width=10ex,minimum height=2.5ex,anchor=south west] (one) at (zero.north west) {  };
  %% \node[circle,draw,darkest,fill=darkred!0.5!yellow,opacity=0.1,text opacity=1.0,draw opacity=1.0,inner sep=0pt,minimum width=2.5ex] (fp-zero) at (zero) { \scriptsize 0 };
    \node[circle,draw,darkest,fill=darkred!0.5!blue,opacity=0.1,text opacity=1.0,draw opacity=1.0,inner sep=0pt,minimum width=2.5ex] at (one) { \scriptsize 0 };
  \draw[->] ($(zero.south west) + (1.5pt,1.5pt)$) to[out=180,loop left,distance=3ex,in=-120] ($(zero.south) + (-3ex,0)$);
}

{
%% 2: STACK_INT 1
  \node[draw=darkest,rounded corners,minimum width=10ex,minimum height=2.5ex,anchor=south west] (two) at (one.north west) { \scriptsize 1 };
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% fp
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{
\node[anchor=east,circle,draw,darkest,fill=darkred!0.5!yellow,opacity=0.1,text opacity=1.0,draw opacity=1.0,inner sep=0pt,minimum width=2.5ex] (fp) at ($(zero.west) + (-3ex,0)$) { \tiny fp };
\draw[->] (fp) -- (zero);
%% fp = 0
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% ep
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{
\node[anchor=west,circle,draw,darkest,fill=green!30!background,opacity=0.1,text opacity=1.0,draw opacity=1.0,inner sep=0pt,minimum width=2.5ex] (ep) at ($(zero.east) + (3ex,0)$) { \tiny ep };
\draw[->] (ep) -- (zero);
%% fp = 0
}


\draw[darkest,opacity=0.5] ($(cp.west|-heap.north) + (0,0)$)
                        -- ++(0,1.5ex)
                        -- node[midway,fill=background,fill opacity=1.0,text opacity=1.0] {\color{darkred}\footnotesize code}
                           ($(code-14.east|-heap.north) +(0,1.5ex) + (0,0)$)
                        -- ++(0,-1.5ex);

\draw[darkest,opacity=0.5] (fp.west|-heap.north)
                        -- ++(0,1.5ex)
                        -- node[midway,fill=background,fill opacity=1.0,text opacity=1.0] (stack-label) {\color{darkred}\footnotesize stack}
                           ($(stack.east|-heap.north) + (0,1.5ex)$)
                        -- ++(0,-1.5ex);

\draw[darkest,opacity=0.5] (heap.west|-heap.north)
                        -- ++(0,1.5ex)
                        -- node[midway,fill=background,fill opacity=1.0,text opacity=1.0] {\color{darkred}\footnotesize heap}
                           ($(heap.east|-heap.north) + (0,1.5ex)$)
                        -- ++(0,-1.5ex);

\end{tikzpicture}